

<!DOCTYPE html>
<html lang="cs">
  <head>
    <meta charset="UTF-8">
    <style>#ul_top_hypers li {
    display: inline;
}</style>

<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Chat aplikace (Sockets.io) | Kroužek programování</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Chat aplikace (Sockets.io)" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Základní komunikace" />
<meta property="og:description" content="Základní komunikace" />
<link rel="canonical" href="http://localhost:4000/project/chat/" />
<meta property="og:url" content="http://localhost:4000/project/chat/" />
<meta property="og:site_name" content="Kroužek programování" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-05-16T10:15:46+02:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Chat aplikace (Sockets.io)" />
<script type="application/ld+json">
{"headline":"Chat aplikace (Sockets.io)","dateModified":"2024-05-16T10:15:46+02:00","datePublished":"2024-05-16T10:15:46+02:00","url":"http://localhost:4000/project/chat/","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/project/chat/"},"@type":"BlogPosting","description":"Základní komunikace","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="preload" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700&display=swap" as="style" type="text/css" crossorigin>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="/assets/css/style.css?v=93f98af6811650191812ee73450360a358bb085a">
  </head>
  <body>
    <a id="skip-to-content" href="#content">Skip to the content.</a>

    <header class="page-header" role="banner">
      <h1 class="project-name">Chat aplikace (Sockets.io)</h1>
      <h2 class="project-tagline">Stránky kroužku programování na VŠB-Technická univerzita Ostrava</h2>

      <a href="http://localhost:4000" class="btn">Domů</a>
        <a class="btn" href="/archive/">
          Archiv
        </a>
        <a class="btn" href="/projects/">
          Zadání
        </a></header>

    <main>

      <div class="container">
      <nav class="side-nav">
                <a href="/class/23_Advanced_1430/">
                  Pokročilí, čt 14:30
                </a>
                <a href="/class/23_Advanced_1600/">
                  Pokročilí, čt 16:00
                </a>
                <a href="/class/23_Beginners_1430/">
                  Začátečníci, čt 14:30
                </a>
                <a href="/class/23_Beginners_1500/">
                  Začátečníci, pá 15:00
                </a>
                <a href="/class/23_Beginners_1600/">
                  Začátečníci, čt 16:00
                </a>
                <a href="/class/23_LoremIpsum_1600/">
                  Lorem Ipsum, čt 16:00
                </a>
                <a href="/class/23_java-Th/">
                  Java
                </a></nav>

      <div id="content" class="main-content" role="main" style="width: 100%;">
      <h1 id="základní-komunikace">Základní komunikace</h1>

<p>Cílem tohoto úkolu bude se seznámit s knihovnou Sockets.io, která nám umožní vytvořit jednoduché klient-server aplikace.</p>

<h2 id="setup">Setup</h2>

<p>Nejprve si vytvořte fork této <a href="https://github.com/RadimBaca/chat">repository</a>. Klikněte tedy na tlačítko <code class="language-plaintext highlighter-rouge">Fork</code> na další stránce klikněte na <code class="language-plaintext highlighter-rouge">Create fork</code>, čímž se vytvoří kopie tohoto repository pod vašim účtem.</p>

<p>Stáhněte lokálně s pomocí <code class="language-plaintext highlighter-rouge">cmd</code> a otevřete projekt ve VSCode.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/vase_jmeno/chat
<span class="nb">cd </span>chat
code <span class="nb">.</span>
</code></pre></div></div>

<p>V repository vidíme dva adresáře. Jeden představuje NodeJS server a druhý představuje klienta.</p>

<h3 id="server">Server</h3>

<p>Začneme zprovozněním serveru. Je nutné se přepnout do adresáře server, nainstalovat <code class="language-plaintext highlighter-rouge">socket.io</code> a server spustit.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>server
npm <span class="nb">install </span>socket.io
node main.js
</code></pre></div></div>

<p>Pokud nevidte žádnou chybu, server běží a čeká na připojení klientů. Jedná se o NodeJS program. Vyzkoušejte server po spuštění přerušit s pomocí klávesové zkratky <code class="language-plaintext highlighter-rouge">ctrl+C</code>. Pokud uděláte nějaké změny v kodu <code class="language-plaintext highlighter-rouge">main.js</code>, tak je nutné běh serveru takto přerušit a spustit jej znovu, aby se změny projevily.</p>

<h3 id="klient">Klient</h3>

<p>Klient je pouze <code class="language-plaintext highlighter-rouge">index.html</code>. Takže otevřete <code class="language-plaintext highlighter-rouge">index.html</code> ve dvou oknech, v jednom něco napište a následně stiskněte tlačítko <code class="language-plaintext highlighter-rouge">SEND</code>. Pokud vše funguje, tak se napsaná zpráva objevila v obou oknech.</p>

<h2 id="jak-to-funguje">Jak to funguje</h2>

<p>Nyní se podrobněji podíváme na to jak to funguje. Základem řešení jsou zprávy posílané mezi jednotlivými aktéry (klient, server). Schematicky je to znázorněno na následujícím obrázku. Máme server ke kterému se připojili dva klienti. Server má seznam připojených klientů a když obdrží zprávu, tak ji rozešle všem.
<img src="images/socket_io1.png" alt="zprávy v socket.io" /></p>

<h3 id="klient-1">Klient</h3>

<p>Pro práci se zprávami máme u klienta k dispozici následující funkce:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">socket.emit('chat_message', msg)</code> - pošle zprávu <code class="language-plaintext highlighter-rouge">chat_message</code> s řětězcovou hodnotou <code class="language-plaintext highlighter-rouge">msg</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">socket.on('chat_message', function X(msg))</code> - pokud obdrží zprávu <code class="language-plaintext highlighter-rouge">chat_message</code> tak spustí funkci <code class="language-plaintext highlighter-rouge">X</code> a předá ji řetězcový parametr <code class="language-plaintext highlighter-rouge">msg</code>.</li>
</ul>

<blockquote>
  <p><strong>Zamyšlení</strong>
Kde jsme již mohli vidět, že předáváme funkci jako parametr?</p>
</blockquote>

<h3 id="server-1">Server</h3>

<p>Na straně serveru vypadají funkce velmi podobně jako u klienta:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">io.emit('chat_message', msg)</code> - pošle zprávu všem klientům.</li>
  <li><code class="language-plaintext highlighter-rouge">socket.on('chat_message', function X(msg))</code> - pokud obdrží zprávu <code class="language-plaintext highlighter-rouge">chat_message</code> tak spustí funkci <code class="language-plaintext highlighter-rouge">X</code> a předá ji řetězcový parametr <code class="language-plaintext highlighter-rouge">msg</code>.</li>
</ul>

<p>Nicméně přece jenom je to na straně serveru malinko komplikovanější. Můžeme si všimnout, že téměř všechen kód se nachází v handleru <code class="language-plaintext highlighter-rouge">io.on('connection', handler)</code>:</p>

<pre><code class="language-JS">io.on('connection', (socket) =&gt; {
  // kód handleru
}
</code></pre>

<p>Můžeme tomu rozumět tak, při vytvoření nového socket spojení (připojení nového klienta) se spustí kód handleru, který následně obsluhuje požadavky klienta. Pokud server provede <code class="language-plaintext highlighter-rouge">io.emit</code> pak se zpráva rozešle všem klientům, jak to deomnstruje následující obrázek.
<img src="images/socket_io2.png" alt="Zaslaní zprávy s pomocí io.emit" /></p>

<blockquote>
  <p><strong>Úkol 1 - odeslání zprávy jen ostatním klientům</strong>
Nyní celý program funguje tak, že pokud klient odešle zprávu <code class="language-plaintext highlighter-rouge">'chat_message'</code>, pak mu zprávu pošle server zpět. Nicméně to je poměrně zbytečné. V Sockets.io <a href="https://socket.io/docs/v3/broadcasting-events/">existuje možnost</a> rozeslat zprávu všem ostatním kromě klienta, který zprávu inicioval s pomocí <code class="language-plaintext highlighter-rouge">socket.broadcast.emit('chat_message' , msg)</code>. Přepište tedy celý program, aby se použil <code class="language-plaintext highlighter-rouge">broadcast.emit</code>.</p>
</blockquote>

<blockquote>
  <p><strong>Úkol 2 - vlastní zprávy v chatu podbarvěte</strong></p>
</blockquote>

<h2 id="json">JSON</h2>

<p>Všimneme si, že při komunikaci si předáváme pouze řetězcové hodnoty. To má za následek skutečnost, že pokud chceme v rámci jedné zprávy předat komplexnější strukturu jako třeba JSON musíme ji nejprve převést na řetězec a pak následně z řetězce zase zpět.</p>

<p>Pro takové převody máme k dispozici následující funkce:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">JSON.stringify(json_object)</code> - převede <code class="language-plaintext highlighter-rouge">json_object</code> na řetězec</li>
  <li><code class="language-plaintext highlighter-rouge">JSON.parse(string)</code> - vrací JSON z řetězce</li>
</ul>

<blockquote>
  <p><strong>Úkol 3 - přidání pořadí zprávy</strong>
U každého klienta si vytvořte číselnou proměnnou, kterou na začátku nastavíte na nula. Při každém odeslání zprávy ji inkrementujete. Pošlete číslo spolu s textem zprávy jako jeden JSON objekt po stisku tlačítka SEND. Objekt je potřeba převést na řetězec s pomocí <code class="language-plaintext highlighter-rouge">JSON.stringify</code> a následně zpět.</p>
</blockquote>

<h2 id="další-úkoly">Další úkoly</h2>

<p>Zkuste nyní dopracovat následující úkoly.</p>

<blockquote>
  <p><strong>Úkol 4 - zadání jména</strong>
Do <code class="language-plaintext highlighter-rouge">class</code> <code class="language-plaintext highlighter-rouge">div</code> elementu s <code class="language-plaintext highlighter-rouge">id="chat"</code> přidejte hodnotu <code class="language-plaintext highlighter-rouge">hidden</code>. Tím celou chatovací část skryjete.
Přidejte druhý <code class="language-plaintext highlighter-rouge">div</code> s textboxem a tlačítkem OK, kde bude uživatel zadávat svoje jméno. Nastavte <code class="language-plaintext highlighter-rouge">div id="init"</code>. Po kliknutí se vymění zobrazení <code class="language-plaintext highlighter-rouge">div</code> (tzn. jeden div zobrazíte a druhý skryjete). Kupříkladu první <code class="language-plaintext highlighter-rouge">div</code> se zobrazí následujícím příkazem <code class="language-plaintext highlighter-rouge">document.getElementById("chat").classList.remove("hidden")</code>.<br />
Uložené jméno pak přidávejte do JSON objektu, který posíláte serveru po stisku tlačítka SEND a jméno pak zobrazujte před samotnou zprávou.</p>
</blockquote>

<blockquote>
  <p><strong>Úkol 5 - přidávání zpráv nahoru</strong>
Nyní se zprávy přidávají dolů. Upravte kód, aby se zprávy přidávaly nahoru.</p>
</blockquote>

<p><a href="/project/chat_room">Pokračování - Socket.io room</a></p>

    </div>
  </div>

  <footer class="site-footer">
    <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span>
  </footer>

    </main>
  </body>
</html>

<style>
  .container{
    display: flex;
    flex-direction: row;
    width: 100%;
  }

  #content{
    border-left: 1px solid #eee;
  }

  nav{
    display: flex;
    flex-direction: column;
    padding: 1rem;
  }

  nav a {
    margin-top: 1rem;
  }
</style>